---
description: Regras completas do projeto Mostralo
globs: 
alwaysApply: true
---

# üéØ REGRAS COMPLETAS DO PROJETO MOSTRALO

## üìã Princ√≠pios Fundamentais

### Comunica√ß√£o e Comportamento
- **SEMPRE responda em portugu√™s brasileiro (pt-BR)**
- V√° direto ao ponto, sem elogios desnecess√°rios como "√≥tima pergunta" ou "excelente ideia"
- Seja factual, objetivo e preciso em todas as respostas
- Adapte a resposta ao contexto: perguntas simples = respostas concisas, perguntas complexas = respostas detalhadas
- **NUNCA** assuma conhecimento que n√£o foi fornecido
- Pergunte esclarecimentos quando necess√°rio (m√°ximo 1 pergunta por resposta)

### Qualidade de C√≥digo
- Escreva c√≥digo limpo, simples e leg√≠vel
- Implemente funcionalidades da forma mais simples poss√≠vel
- Mantenha arquivos pequenos e focados (<200 linhas para componentes)
- Use nomes claros e consistentes
- Pense profundamente antes de codificar (2-3 par√°grafos de racioc√≠nio)
- **SEMPRE** escreva c√≥digo simples, limpo e modular
- Use linguagem clara e f√°cil de entender, escreva em frases curtas

## üõ†Ô∏è Stack Tecnol√≥gica

### Frontend
- **React 18.3.1** com **TypeScript 5.8.3**
- **Vite 5.4.19** como build tool
- **Tailwind CSS 3.4.17** + **Shadcn/ui** completo
- **Radix UI** (todos os componentes)
- **TanStack Query 5.83.0** para data fetching
- **React Router DOM v6** para roteamento
- **React Hook Form 7.61.1** + **Zod 4.1.12** para formul√°rios
- **Supabase JS 2.55.0** para backend
- **Mapbox GL 3.15.0** + **Turf.js 7.2.0** para mapas
- **Recharts** para gr√°ficos
- **Date-fns** para manipula√ß√£o de datas
- **Sonner** para toasts
- **React Beautiful DnD** para drag and drop
- **Next-themes** para dark/light theme
- **Lucide React** para √≠cones

### Backend
- **Supabase** (PostgreSQL + Auth + Storage + Edge Functions)
- Cliente Supabase conectado diretamente √† produ√ß√£o (URL hardcoded)

## üìê Estrutura de Arquivos

### Limites de Linhas por Arquivo
- **Componentes React**: 200 linhas (m√°ximo)
- **Fun√ß√µes utilit√°rias**: 100 linhas
- **Arquivos de configura√ß√£o**: 150 linhas
- **Hooks customizados**: 100 linhas
- **Servi√ßos/APIs**: 250 linhas
- **Tipos/Interfaces**: 150 linhas

### Quando um arquivo exceder o limite:
1. Refatorar em componentes menores
2. Extrair l√≥gica para hooks ou utilit√°rios
3. Dividir em m√∫ltiplos arquivos relacionados
4. Criar subpastas quando necess√°rio

### Estrutura de Pastas Obrigat√≥ria
```
src/
‚îú‚îÄ‚îÄ components/          # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ ui/             # Componentes base Shadcn/ui
‚îÇ   ‚îú‚îÄ‚îÄ admin/          # Componentes do painel admin
‚îÇ   ‚îú‚îÄ‚îÄ delivery/       # Componentes para entregadores
‚îÇ   ‚îî‚îÄ‚îÄ checkout/       # Componentes de checkout
‚îú‚îÄ‚îÄ pages/              # P√°ginas/rotas
‚îÇ   ‚îú‚îÄ‚îÄ admin/          # P√°ginas do painel admin
‚îÇ   ‚îú‚îÄ‚îÄ delivery/       # P√°ginas para entregadores
‚îÇ   ‚îî‚îÄ‚îÄ cliente/        # P√°ginas para clientes
‚îú‚îÄ‚îÄ hooks/              # Hooks customizados
‚îú‚îÄ‚îÄ contexts/           # Context API (Auth, Cart, etc.)
‚îú‚îÄ‚îÄ utils/              # Fun√ß√µes utilit√°rias
‚îú‚îÄ‚îÄ types/              # Defini√ß√µes TypeScript
‚îú‚îÄ‚îÄ lib/                # Bibliotecas e configura√ß√µes
‚îú‚îÄ‚îÄ integrations/       # Integra√ß√µes (Supabase, etc.)
‚îî‚îÄ‚îÄ config/             # Configura√ß√µes da aplica√ß√£o
```

## üî∑ TypeScript

### Regras Cr√≠ticas
- **Tipagem total e expl√≠cita** - Nenhum `any`, nenhuma infer√™ncia impl√≠cita
- **Use TypeScript para TUDO** - 100% dos arquivos
- **Prefira interfaces sobre types** para formas de objeto
- **Evite enums** - use literal types ou maps
- **Compatibilidade total** com ESLint e TypeScript - nenhum erro, nenhum warning
- **C√≥digo limpo e validado** antes de finalizar

### Conven√ß√µes de Nomenclatura
- **Booleans**: Use verbos auxiliares (`isLoading`, `hasError`, `shouldRender`)
- **Componentes**: PascalCase (`UserProfile.tsx`)
- **Utilit√°rios**: camelCase (`formatDate.ts`)
- **Constantes**: UPPER_SNAKE_CASE (`API_URLS.ts`)
- **Hooks**: camelCase com "use" (`useUserData.ts`)
- **Diret√≥rios**: lowercase com dashes (`components/auth-wizard`)

## ‚öõÔ∏è React

### Componentes
- **SEMPRE use componentes funcionais** - nunca classes
- **Use `function` keyword** para componentes, n√£o `const`
- **Prefira named exports** para componentes
- **Estrutura de arquivo**: Componente exportado, subcomponentes, helpers, conte√∫do est√°tico, tipos
- **Minimize `use client`** - use apenas quando necess√°rio para Web APIs
- **Evite `useEffect` e `setState`** - prefira derived state e memoization
- **Use React Server Components** quando poss√≠vel

### JSX e Renderiza√ß√£o
- Use JSX declarativo
- Evite chaves desnecess√°rias em condicionais
- Use sintaxe concisa para statements simples: `if (condition) doSomething()`
- Coloque conte√∫do est√°tico e interfaces no final do arquivo
- Use vari√°veis de conte√∫do para conte√∫do est√°tico fora de fun√ß√µes de render

### Hooks e Estado
- **Custom hooks**: m√°ximo 100 linhas
- **Prefira Context API** para estado global compartilhado
- **Use TanStack Query** para data fetching e cache
- **Minimize re-renders** com `useMemo` e `useCallback` quando apropriado

## üé® Estiliza√ß√£o

### Tailwind CSS
- Use **Tailwind CSS** para estiliza√ß√£o (Utility First)
- Use **Class Variance Authority (CVA)** para variantes de componentes
- **Mobile-first** para design responsivo
- Use **CSS vars** para temas (light/dark)
- Cores prim√°rias: orange (#F97316)

### Componentes UI
- Use **Shadcn/ui** e **Radix UI** para componentes base
- Mantenha consist√™ncia visual entre componentes
- Use **Lucide React** para √≠cones

## üóÑÔ∏è Supabase

### Banco de Dados
- **35 tabelas** no schema public
- Use **Row Level Security (RLS)** para controle de acesso
- **SEMPRE** verifique RLS policies antes de queries
- Use **migrations** para mudan√ßas no schema
- **NUNCA** fa√ßa altera√ß√µes diretas no banco sem migration

### Autentica√ß√£o
- Use **Supabase Auth** para autentica√ß√£o
- **Roles**: `master_admin`, `store_admin`, `delivery_driver`, `customer`, `attendant`
- Use **user_roles** table para gerenciar permiss√µes
- **SEMPRE** verifique permiss√µes antes de opera√ß√µes sens√≠veis

### Edge Functions
- Use **Edge Functions** para opera√ß√µes sens√≠veis (cria√ß√£o de usu√°rios, etc.)
- **SEMPRE** inclua tratamento de CORS
- Use **service role key** para opera√ß√µes administrativas
- **SEMPRE** valide autentica√ß√£o antes de processar
- Retorne mensagens de erro detalhadas (code, message, details, hint)

### Queries
- **Otimize queries** - busque apenas dados necess√°rios
- Use **select espec√≠fico** - n√£o use `select('*')`
- **SEMPRE** trate erros de query
- Use **real-time subscriptions** quando apropriado

## üö´ O Que NUNCA Fazer

### C√≥digo
- ‚ùå **NUNCA** use `any` em TypeScript
- ‚ùå **NUNCA** crie arquivos > 200 linhas sem refatorar
- ‚ùå **NUNCA** duplique c√≥digo - verifique se j√° existe funcionalidade similar
- ‚ùå **NUNCA** crie estrutura de pastas sem ser solicitado
- ‚ùå **NUNCA** use bibliotecas de terceiros sem pedido expl√≠cito
- ‚ùå **NUNCA** inclua exemplos, placeholders, mock data ou coment√°rios desnecess√°rios
- ‚ùå **NUNCA** adicione anima√ß√µes, estilos ou funcionalidades "sugeridas"
- ‚ùå **NUNCA** adivinhe inten√ß√µes - siga o pedido ao p√© da letra
- ‚ùå **NUNCA** use classes em React
- ‚ùå **NUNCA** crie arquivos tempor√°rios (temp.js, backup.js)
- ‚ùå **NUNCA** use `console.log` em produ√ß√£o - use sistema de logs apropriado

### Arquivos Desnecess√°rios
- ‚ùå Arquivos de exemplo n√£o utilizados
- ‚ùå Duplicatas (component.jsx e component.tsx)
- ‚ùå Configs redundantes
- ‚ùå Componentes gen√©ricos demais (Container.jsx, Wrapper.jsx)
- ‚ùå Utilit√°rios de uma linha (criar arquivo s√≥ para uma fun√ß√£o simples)

### Decis√µes
- ‚ùå **NUNCA** crie algo porque "acha que √© melhor" ou "vai ajudar"
- ‚ùå **NUNCA** tome decis√µes criativas sem solicita√ß√£o
- ‚ùå **NUNCA** sobrescreva arquivo .env sem primeiro perguntar e confirmar
- ‚ùå **NUNCA** simule dados para dev ou prod - apenas para testes

## ‚úÖ O Que SEMPRE Fazer

### C√≥digo
- ‚úÖ **SEMPRE** use TypeScript com tipagem completa
- ‚úÖ **SEMPRE** valide c√≥digo com ESLint e TypeScript antes de finalizar
- ‚úÖ **SEMPRE** trate erros e edge cases
- ‚úÖ **SEMPRE** use early returns para evitar nesting profundo
- ‚úÖ **SEMPRE** use guard clauses para precondi√ß√µes
- ‚úÖ **SEMPRE** implemente loading e error states
- ‚úÖ **SEMPRE** use semantic HTML
- ‚úÖ **SEMPRE** escreva c√≥digo funcional e completo - nada de placeholders
- ‚úÖ **SEMPRE** verifique se funcionalidade similar j√° existe antes de criar nova

### Coment√°rios
- ‚úÖ **SEMPRE** adicione coment√°rios √∫teis e explicativos
- ‚úÖ **NUNCA** delete coment√°rios antigos - a menos que estejam obviamente errados/obsoletos
- ‚úÖ **SEMPRE** escreva c√≥digo bem documentado
- ‚úÖ **SEMPRE** documente mudan√ßas e racioc√≠nio NOS COMENT√ÅRIOS
- ‚úÖ Use linguagem clara e f√°cil de entender nos coment√°rios

### Estrutura
- ‚úÖ **SEMPRE** crie componente quando ser√° reutilizado em 2+ lugares
- ‚úÖ **SEMPRE** crie arquivo quando l√≥gica tem mais de 50 linhas
- ‚úÖ **SEMPRE** crie arquivo quando funcionalidade tem responsabilidade √∫nica clara
- ‚úÖ **SEMPRE** siga a estrutura de pastas obrigat√≥ria

## üîç Debugging e Resolu√ß√£o de Problemas

### Processo de Debug
1. **N√ÉO PULE PARA CONCLUS√ïES!** Considere m√∫ltiplas causas poss√≠veis antes de decidir
2. **Explique o problema** em portugu√™s claro
3. **Fa√ßa mudan√ßas m√≠nimas necess√°rias** - mude o menor n√∫mero de linhas poss√≠vel
4. **Em caso de erros estranhos**, pe√ßa ao usu√°rio para fazer busca web (Perplexity) para informa√ß√µes atualizadas
5. **Analise m√∫ltiplas causas** poss√≠veis
6. **Reduza para as mais prov√°veis** (1-2 causas)
7. **Adicione logs** para validar suposi√ß√µes
8. **Reflita profundamente** sobre o problema antes de implementar corre√ß√£o

### Tratamento de Erros
- **Priorize tratamento de erros** e edge cases
- **Trate erros no in√≠cio** das fun√ß√µes
- **Use early returns** para condi√ß√µes de erro
- **Coloque happy path por √∫ltimo** na fun√ß√£o
- **Evite else desnecess√°rios** - use padr√£o if-return
- **Use guard clauses** para precondi√ß√µes e estados inv√°lidos
- **Implemente logging apropriado** e mensagens de erro amig√°veis
- **Considere usar tipos de erro customizados** para consist√™ncia

## üìù Formata√ß√£o e Estilo

### C√≥digo
- Use **`function` keyword** para fun√ß√µes puras
- **Omita ponto e v√≠rgula** (semicolons)
- Use **sintaxe concisa** para statements simples
- **Evite chaves desnecess√°rias** em condicionais simples
- Use **lowercase com dashes** para diret√≥rios
- Use **PascalCase** para componentes
- Use **camelCase** para fun√ß√µes e vari√°veis

### Respostas
- **Perguntas simples**: Respostas concisas (1-2 frases)
- **Perguntas complexas**: Respostas detalhadas e completas
- **Conversas t√©cnicas**: Use terminologia apropriada
- **Evite elogios desnecess√°rios** ao in√≠cio das respostas
- **Seja direto** sobre limita√ß√µes (1-2 frases m√°ximo)

## üß™ Testes e Valida√ß√£o

### Processo de Build
- **Verifique cada nova feature** dizendo ao usu√°rio como testar
- **N√ÉO escreva c√≥digo complicado e confuso** - opte pela abordagem simples e modular
- **Quando n√£o tiver certeza**, pe√ßa ao usu√°rio para fazer busca web
- **Teste ap√≥s cada mudan√ßa significativa**

### Valida√ß√£o
- Use **Zod** para valida√ß√£o de schemas
- Use **React Hook Form** com Zod para formul√°rios
- **SEMPRE** valide dados antes de enviar ao backend
- **SEMPRE** valide respostas do backend

## üöÄ Performance

### Otimiza√ß√µes
- **Otimize imagens**: WebP format, size data, lazy loading
- **Use dynamic loading** para componentes n√£o cr√≠ticos
- **Minimize re-renders** com memoiza√ß√£o apropriada
- **Use code splitting** quando apropriado
- **Otimize queries** - busque apenas dados necess√°rios

### Limites de Context
- **Prompt m√°ximo**: 2000 tokens por intera√ß√£o
- **Arquivos no contexto**: m√°ximo 5 arquivos simultaneamente
- **Quebrar grandes refatora√ß√µes** em chunks menores
- **Usar @workspace** com parcim√¥nia

## üéØ Padr√µes Espec√≠ficos do Projeto

### Autentica√ß√£o
- Use **AuthContext** para gerenciar autentica√ß√£o
- **Roles**: `master_admin`, `store_admin`, `delivery_driver`, `customer`, `attendant`
- **SEMPRE** verifique role antes de opera√ß√µes sens√≠veis
- Use **ProtectedRoute** para rotas protegidas (50+ rotas)
- **Impersonation**: timeout de seguran√ßa de 10s, limpa localStorage no logout

### Carrinho
- Use **CartContext** para gerenciar carrinho
- M√©todos: `addItem`, `removeItem`, `updateQuantity`, `clearCart`, `getTotalPrice`, `getTotalItems`

### Rotas
- **P√∫blicas**: `/`, `/loja/:slug`, `/loja/:slug/promocoes`, `/loja/:storeSlug/produto/:productSlug`
- **Admin protegidas**: `/dashboard/*` (20+ rotas, acesso `store_admin`/`master_admin`)
- **Delivery protegidas**: `/delivery-*` (5 rotas, acesso `delivery_driver`)
- **Cliente**: `/cliente/:storeSlug`, `/painel-cliente/:storeSlug`, `/checkout`, `/pedido/:orderId`

### Layouts
- **AdminLayout** para dashboards
- **DeliveryDriverLayout** para entregadores
- **ThemeController** com `useRouteTheme` para temas por rota

## üìö Documenta√ß√£o

### Coment√°rios
- **SEMPRE** adicione coment√°rios √∫teis e explicativos
- Use **JSDoc** para fun√ß√µes e componentes quando apropriado
- **Documente mudan√ßas** e racioc√≠nio nos coment√°rios
- Use **linguagem clara** e f√°cil de entender

### C√≥digo
- **C√≥digo auto-documentado** atrav√©s de nomes descritivos
- **Separa√ß√£o de concerns**: UI/Logic/Data
- **Componentiza√ß√£o modular**

## üîí Seguran√ßa

### Supabase
- **SEMPRE** use RLS policies
- **SEMPRE** valide autentica√ß√£o em Edge Functions
- **SEMPRE** verifique permiss√µes antes de opera√ß√µes sens√≠veis
- **NUNCA** exponha service role key no frontend
- Use **Edge Functions** para opera√ß√µes administrativas

### Dados
- **NUNCA** simule dados para dev ou prod
- **SEMPRE** valide dados do usu√°rio
- **SEMPRE** sanitize inputs antes de processar

## üé® Design e UX

### Temas
- **Dark/Light theme** com CSS vars customizadas
- **Cores prim√°rias**: orange (#F97316)
- **Anima√ß√µes customizadas**: pulse-alert, shimmer, blink-border, shake, screen-flash
- **Utilidades**: line-clamp, scrollbar-hide, hover-scale

### Acessibilidade
- **SEMPRE** use semantic HTML
- **SEMPRE** implemente navega√ß√£o por teclado
- **SEMPRE** use ARIA labels e roles apropriados
- **SEMPRE** garanta contraste de cores adequado

## üì¶ Depend√™ncias e Gerenciamento

### Package Manager
- **Bun** como gerenciador de pacotes padr√£o
- **Scripts**: `dev`, `build`, `build:dev`, `lint`, `preview`

### Vite Config
- **Server port**: 8080
- **React SWC** para compila√ß√£o r√°pida
- **PWA plugin** com registerType autoUpdate
- **Cache de assets** e runtime caching para JS e Supabase

## üö® Regras de Prioridade

### M√°xima Prioridade (Inviol√°vel)
1. **TypeScript com tipagem completa** - NUNCA use `any`
2. **Arquivos < 200 linhas** - refatore quando exceder
3. **C√≥digo funcional e completo** - nada de placeholders
4. **Seguir pedido ao p√© da letra** - n√£o inventar funcionalidades
5. **Responder sempre em pt-BR**

### Alta Prioridade
1. **Tratamento de erros** completo
2. **Valida√ß√£o de dados** com Zod
3. **RLS policies** no Supabase
4. **C√≥digo limpo e leg√≠vel**
5. **Coment√°rios explicativos**

### M√©dia Prioridade
1. **Performance** otimiza√ß√µes
2. **Acessibilidade** features
3. **Documenta√ß√£o** detalhada
4. **Testes** quando apropriado

## ‚úÖ Checklist Antes de Finalizar

- [ ] C√≥digo est√° 100% tipado (sem `any`)
- [ ] Nenhum erro de ESLint ou TypeScript
- [ ] Arquivos n√£o excedem limite de linhas
- [ ] Tratamento de erros implementado
- [ ] Coment√°rios explicativos adicionados
- [ ] C√≥digo segue padr√µes do projeto
- [ ] Funcionalidade testada (se aplic√°vel)
- [ ] Resposta em portugu√™s brasileiro

## üéØ Resumo Mental

**"N√£o crio nada al√©m do que me foi explicitamente pedido. N√£o invento. N√£o decido. Apenas obede√ßo. C√≥digo limpo, tipado, modular e funcional. Sempre em portugu√™s brasileiro."**

---

**Lembre-se**: A qualidade est√° na **clareza, precis√£o e utilidade**, n√£o na quantidade de palavras ou formata√ß√£o elaborada.


